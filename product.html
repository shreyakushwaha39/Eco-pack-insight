<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Product Detail</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 2em; max-width: 600px; margin: auto; }
    .eco-score.high { color: green; font-weight: bold; }
    .eco-score.medium { color: orange; font-weight: bold; }
    .eco-score.low { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h2 id="prodName"></h2>
  <p><b>Category:</b> <span id="prodCategory"></span></p>
  <p><b>Eco Score:</b> <span id="prodScore" class="eco-score"></span></p>
  <canvas id="matChart" width="300" height="300"></canvas>
  <p id="prodDesc"></p>

  <script>
    async function loadProduct() {
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get('id');
      const res = await fetch('products.json');
      const products = await res.json();
      const prod = products.find(p => p.id === id);
      if (!prod) {
        document.body.innerHTML = '<h2>Product not found</h2>';
        return;
      }

      document.getElementById('prodName').textContent = prod.name;
      document.getElementById('prodCategory').textContent = prod.category;
      const ecoScoreEl = document.getElementById('prodScore');
      ecoScoreEl.textContent = prod.ecoScore;
      ecoScoreEl.classList.add(prod.ecoScore);
      document.getElementById('prodDesc').textContent = prod.full_description;

      new Chart(document.getElementById('matChart'), {
        type: 'pie',
        data: {
          labels: Object.keys(prod.materials),
          datasets: [{
            data: Object.values(prod.materials),
            backgroundColor: ['#81c784', '#ffd54f', '#e57373', '#64b5f6', '#ba68c8', '#b0bec5']
          }]
        },
        options: {
          responsive: true
        }
      });
    }

    loadProduct();
  </script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
  function downloadAsPDF() {
    const element = document.getElementById('productModal');
    const opt = {
      margin: 0.5,
      filename: 'product-details.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    };
    html2pdf().set(opt).from(element).save();
  }
</script>
</body>
</html>

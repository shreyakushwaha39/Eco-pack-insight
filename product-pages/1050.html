<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Granola Pouch</title>

  <!-- Chart.js and html2pdf -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
      color: #333;
    }

    .container {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }

    img {
      width: 100%;
      border-radius: 8px;
    }

    .section {
      margin-top: 20px;
    }

    button {
      margin-top: 20px;
      padding: 10px 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    canvas {
      max-width: 100%;
    }

    #pdf-content * {
      box-sizing: border-box;
    }

    @media print {
      canvas {
        break-inside: avoid;
        page-break-inside: avoid;
      }
    }
  </style>
</head>

<body>
  <!-- PDF content starts here -->
  <div class="container" id="pdf-content">
    <img src="../images/1050.webp" alt="Granola Pouch" style="max-width: 100%; height: auto; margin-bottom: 15px;" />
    <h1>Granola Pouch</h1>
    <p><strong>Category:</strong> Snacks</p>

    <div class="section">
      <h3>Description</h3>
      <p>
        Granola Pouch uses a plastic body with a paper label. The pouch is not recyclable, but the label is.
        Look for brands using paper or compostable pouches. The packaging is designed for easy transport
        and optimized for shelf space. It's lightweight and reduces carbon emissions during shipping.
      </p>
    </div>

    <div class="section">
      <h3>Material Composition</h3>
      <!-- Canvas chart to be hidden before PDF -->
      <canvas id="materialsChart" width="180" height="180" style="margin-bottom: 15px;"></canvas>
      <!-- Image version of chart (used in PDF) -->
      <img id="chartImage" style="display:none; margin-bottom: 15px;" />
      <ul>
        <li>Plastic: 90%</li>
        <li>Paper: 10%</li>
      </ul>
    </div>

    <div class="section">
      <p><strong>Eco Score:</strong> Low</p>
    </div>
  </div>

  <!-- PDF button -->
  <div class="container" style="text-align:center;">
    <button onclick="downloadPDF()">Download as PDF</button>
  </div>

  <script>
    // Draw pie chart and convert it to image
    function drawChartAndConvert(callback) {
      const ctx = document.getElementById('materialsChart').getContext('2d');

      const chart = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['Plastic', 'Paper'],
          datasets: [{
            data: [90, 10],
            backgroundColor: ['#81c784', '#ffd54f']
          }]
        },
        options: {
          responsive: false,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });

      // Convert canvas to image after a short delay
      setTimeout(() => {
        const canvas = document.getElementById('materialsChart');
        const chartImg = document.getElementById('chartImage');

        chartImg.src = canvas.toDataURL("image/png");
        chartImg.style.display = 'block';
        canvas.style.display = 'none';

        callback();
      }, 500);
    }

    // Download PDF
    function downloadPDF() {
      drawChartAndConvert(() => {
        const element = document.getElementById('pdf-content');

        const opt = {
          margin: 0.3,
          filename: 'Granola_Pouch.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 1.5, useCORS: true },
          jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' },
          pagebreak: { mode: ['css', 'legacy'] }
        };

        html2pdf().set(opt).from(element).save();
      });
    }
  </script>
</body>
</html>

